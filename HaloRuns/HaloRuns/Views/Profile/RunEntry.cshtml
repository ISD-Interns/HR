@model HaloRuns.Models.ViewModels.RunForm


@section Title { Run Entry }

<strong>Create a Request for @Model.user.Username</strong>
<div class="RunFormcontainer" style="padding-top:50px">

    @using (Html.BeginForm("Create", "Runs", FormMethod.Post, new { @id = "CreateRequestPartialForm", @class = "form-horizontal", role = "form" }))
    {
        <h2>Create a Request</h2>
        <p>The select element is used to create a drop-down list.</p>

        <form id="Table">
            <label for="game">Choose a game:</label>
            <select id="games">

                <option value="-1">no selection</option>
                @foreach (var game in Model.games)
                {
                    <option value="@game.id"
                            data-edition-list-endpoint="@Url.RouteUrl("RunEntryFetchEditionRouteName", new { user = Model.user.Username, game = game.RouteName })"
                            data-map-list-endpoint="@Url.RouteUrl("RunEntryFetchMapRouteName", new { user = Model.user.Username, game = game.RouteName })">
                        @game.name
                    </option>
                }
            </select>
            <label for="edition">Choose an editon:</label>
            <select id="editions" class="editions">
                <option value="-1">no selection</option>
            </select>

            <label for="map">Choose a map:</label>
            <select id="maps" class="maps">
                <option value="-1"> no selction</option>
            </select>

            <label for="birthday">Date Ran:</label>
            <input type="date" id="birthday" name="birthday">
            <input type="submit">

        </form>
        <div class="container">
            <div class="inner">Hello</div>
            <div class="inner">Goodbye</div>
        </div>
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })


        <div class="form-group" style="padding-left:250px;padding-top:5px">
            <div class="col-xs-5">
                <input type="submit" id="submitButton" class="btn btn-primary" value="Submit" enabled />
            </div>
        </div>

        <div class="form-group" style="padding-left: 225px;padding-top:10px">
            <div class="col-xs-5">
                <input type="button" value="Cancel Request" onclick="location.href = '@Url.Action("Index")'" />
            </div>

        </div>
    }
</div>


@section Scripts
{
    <script>
        $(document).ready(function () {
            $('#games').change(function () {
                /*
                function filter(myarray, pred)
                {
                    let ret = [];
                    for (let i = 0; i < myarray.length; ++i) {
                        if (pred(i) == true) {
                            ret.append(myarray[i]);
                        }
                    }
				}
                */
                $("#editions").children().filter(function (index) {
                    //return $(this).name != null;
                    return index != 0;
                }).remove();
                $("#maps").children().filter(function (index) {
                    //return $(this).name != null;
                    return index != 0;
                }).remove();
                /*
                $("#editions").children().filter(function (index) {
                    return index != 0;
                }.each(function (item) { item.empty(); });
                */

                const AbrevGameEdition = $(this).children('option:selected').first().data("edition-list-endpoint");
                $.get(AbrevGameEdition, null, function (response) {
                    console.log("hello");
                    response.forEach(function (item) {
                        const editionName = item.name;
                        $(".editions").append(`<option>${editionName}</option>`);
                    });
                });
                
                const AbrevGameMap = $(this).children('option:selected').first().data("map-list-endpoint");
                $.get(AbrevGameMap, null, function (response) {
                    console.log("hello");
                    response.forEach(function (item) {
                        const mapName = item.name;
                        $(".maps").append(`<option>${mapName}</option>`);
                    });
                });

            });
        });
    </script>
}
